#AgentCodeStarted
import os
import logging
from flask import request
from pathlib import Path

LOG_DIR = "/data/logs/ffa94a6ffa1846fc/ffa94a6ffa1846fc_10"
LOG_FILE = os.path.join(LOG_DIR, "ffa94a6ffa1846fc_10.log")
os.makedirs(LOG_DIR, exist_ok=True)
os.makedirs("/data/output/ffa94a6ffa1846fc/", exist_ok=True)

logging.basicConfig(
    filename=LOG_FILE,
    filemode="a",
    format="%(asctime)s - %(levelname)s - %(message)s",
    level=logging.INFO
)

def main():
    try:
        logging.info("***************File Reader Agent triggered***************")
        data = request.get_json(force=True)
        logging.info("Request Data %s", data)
        audit_results_path = data.get("audit_results_path")
        folder = Path(audit_results_path)
        audit_results = {}

        for filename in os.listdir(audit_results_path):
            full_path = os.path.join(audit_results_path, filename)
            with open(full_path, "r", encoding = "utf-8", errors = "ignore") as f:
                audit_results[filename] = f.read()

        logging.info("Agent finished reading file")
        output = {
            "status": "success",
            "audit_results": audit_results
        }
        return output
    except Exception as e:
        logging.error("Exception: %s", str(e))
        return {
            "status": "error",
            "message": str(e)
        }
#AgentCodeEnded
